<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Application Details</title>
<style>
/* --- YOUR EXISTING STYLES (CONDENSED FOR SPACE) --- */
*{box-sizing:border-box}body{margin:0;font-family:system-ui;background:#f4f5f7}
.container{max-width:1100px;margin:24px auto;padding:24px 32px;background:#fff;border-radius:12px;box-shadow:0 12px 30px rgba(15,23,42,.12)}
h1{text-align:center;margin:0 0 20px;text-transform:uppercase;letter-spacing:.12em}
.field{display:flex;flex-direction:column;margin-bottom:12px}
label{font-size:13px;font-weight:600;color:#374151;margin-bottom:4px}
input,textarea,select{padding:8px 10px;border:1px solid #cbd5e1;border-radius:8px;font-size:14px;width:100%}
input:focus,textarea:focus,select:focus{border-color:#2563eb;box-shadow:0 0 0 2px rgba(37,99,235,.16)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
.table-wrapper{overflow-x:auto;border:1px solid #e5e7eb;border-radius:8px;margin-top:10px}
table{min-width:700px;width:100%;border-collapse:collapse}
th,td{border:1px solid #e5e7eb;padding:6px 8px;font-size:13px}
.table-input{width:100%;border:none}
button{padding:10px 22px;font-size:14px;border:none;border-radius:50px;color:white;cursor:pointer;margin:6px 4px}
#saveTxt{background:#10b981}
#saveCsv{background:#3b82f6}
#saveJson{background:#7c3aed}
#savePdf{background:#ef4444}
#addRowBtn{background:#2563eb;margin-top:14px}
.footer-grid{display:flex;flex-wrap:wrap;gap:20px;margin-top:18px}
.footer-column{flex:1 1 260px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:10px;padding:10px}
@media(max-width:768px){
.container{margin:10px;padding:16px}
button{width:100%}
.grid{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="container">
<h1>Application Details</h1>

<div class="grid">
  <div class="field"><label>Date</label><input type="date"></div>
  <div class="field"><label>Crop Type</label><input type="text"></div>
  <div class="field"><label>Client Name</label><input type="text"></div>
  <div class="field"><label>Pest Type</label><input type="text"></div>
  <div class="field"><label>Client Contact</label><input type="text"></div>
  <div class="field"><label>Pilot</label><input type="text"></div>
  <div class="field"><label>Client Address</label><input type="text"></div>
  <div class="field"><label>Area Affected (Ha)</label><input type="number"></div>
  <div class="field"><label>Aircraft</label><input type="text"></div>
  <div class="field"><label>Strip</label><input type="text"></div>
  <div class="field">
    <label>Map Supplied</label>
    <select><option>YES</option><option>NO</option></select>
  </div>
</div>

<h3>Loads</h3>
<div class="table-wrapper">
<table>
<thead>
<tr>
<th>Load</th><th>Size</th><th>Chemical</th><th>Dosage</th><th>Mix Qty</th>
</tr>
</thead>
<tbody id="loadsBody"></tbody>
</table>
</div>

<button id="addRowBtn">+ Add Row</button>

<h3>Advisory Information</h3>
<div class="footer-grid">
<div class="footer-column">
  <label>Infestation level</label><select><option></option><option>YES</option><option>NO</option></select>
  <label>Withholding period</label><select><option></option><option>YES</option><option>NO</option></select>
  <label>Safe re-entry time</label><select><option></option><option>YES</option><option>NO</option></select>
  <label>Notification</label><select><option></option><option>YES</option><option>NO</option></select>
  <label>Additional precautions</label><select><option></option><option>YES</option><option>NO</option></select>
</div>

<div class="footer-column">
  <label>Comments</label>
  <textarea></textarea>
</div>

<div class="footer-column">
  <label>Client/Advisor Company</label><input type="text">
  <label>Client/Advisor Name</label><input type="text">
  <label>Signature</label><input type="text">
</div>
</div>

<h3>Save Options</h3>
<button id="saveTxt">Save TXT</button>
<button id="saveCsv">Save CSV</button>
<button id="saveJson">Save JSON</button>
<button id="savePdf">Save PDF</button>

</div>

<script>
/* ------------------ TABLE ROWS ------------------ */
function createLoadRow(){
  const row=document.createElement("tr");
  ["load","size","chem","dose","mix"].forEach(()=> {
    let td=document.createElement("td");
    let input=document.createElement("input");
    input.className="table-input";
    td.appendChild(input);
    row.appendChild(td);
  });
  document.getElementById("loadsBody").appendChild(row);
}
for(let i=0;i<5;i++) createLoadRow();
document.getElementById("addRowBtn").onclick=()=>createLoadRow();

/* ------------------ COLLECT FORM DATA ------------------ */
function collectData(){
  let data = {};

  // All text inputs, dates, numbers
  document.querySelectorAll("input, textarea, select").forEach((el,i)=>{
    data["field_"+i] = el.value;
  });

  // Load table
  data.loads = [];
  document.querySelectorAll("#loadsBody tr").forEach(row=>{
    let r=[];
    row.querySelectorAll("input").forEach(c=>r.push(c.value));
    data.loads.push(r);
  });

  return data;
}

/* ------------------ DOWNLOAD CREATE ------------------ */
function download(filename, text){
  const blob = new Blob([text], {type:"text/plain"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
}

/* ------------------ SAVE AS TXT ------------------ */
document.getElementById("saveTxt").onclick=()=>{
  const d=collectData();
  let out="APPLICATION DETAILS\n\n";

  Object.keys(d).forEach(k=>{
    if(k!=="loads") out+=`${k}: ${d[k]}\n`;
  });

  out+="\nLOAD TABLE:\n";
  d.loads.forEach((r,i)=> out+=`Row ${i+1}: ${r.join(" | ")}\n`);

  download("application.txt",out);
};

/* ------------------ SAVE AS CSV ------------------ */
document.getElementById("saveCsv").onclick=()=>{
  const d=collectData();
  let csv="Field,Value\n";

  Object.keys(d).forEach(k=>{
    if(k!=="loads") csv+=`${k},${d[k]}\n`;
  });

  csv+="\nLoad,Size,Chemical,Dosage,Mix\n";
  d.loads.forEach((r)=> csv+=`${r.join(",")}\n`);

  download("application.csv",csv);
};

/* ------------------ SAVE AS JSON ------------------ */
document.getElementById("saveJson").onclick=()=>{
  const d=collectData();
  download("application.json",JSON.stringify(d,null,2));
};

/* ------------------ SAVE AS PDF (Simple text) ------------------ */
document.getElementById("savePdf").onclick=()=>{
  const d=collectData();
  let text="APPLICATION DETAILS\n\n";

  Object.keys(d).forEach(k=>{
    if(k!=="loads") text+=`${k}: ${d[k]}\n`;
  });

  text+="\nLOAD TABLE:\n";
  d.loads.forEach((r,i)=> text+=`Row ${i+1}: ${r.join(" | ")}\n`);

  // Use simple Blob PDF
  const blob=new Blob([text],{type:"application/pdf"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="application.pdf";
  a.click();
};

/* ------------------ AUTO SAVE EVERY 2 SECONDS ------------------ */
setInterval(()=>{
  const d=collectData();
  localStorage.setItem("autosave_app_form", JSON.stringify(d));
},2000);

/* ------------------ AUTO LOAD ON STARTUP ------------------ */
window.onload=()=>{
  const saved=localStorage.getItem("autosave_app_form");
  if(!saved) return;

  const d=JSON.parse(saved);

  let i=0;
  document.querySelectorAll("input, textarea, select").forEach(el=>{
    if(d["field_"+i]!==undefined) el.value=d["field_"+i];
    i++;
  });

  // Load table
  document.getElementById("loadsBody").innerHTML="";
  d.loads.forEach(row=>{
    createLoadRow();
  });

  // Insert load values
  let rowIndex=0;
  document.querySelectorAll("#loadsBody tr").forEach(tr=>{
    let cellIndex=0;
    tr.querySelectorAll("input").forEach(input=>{
      input.value=d.loads[rowIndex][cellIndex];
      cellIndex++;
    });
    rowIndex++;
  });
};
</script>

</body>
</html>
